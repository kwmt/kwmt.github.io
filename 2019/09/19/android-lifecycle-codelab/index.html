
<!DOCTYPE html>
<html lang="ja">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" Android Lifecycle関連コンポーネントについて &middot;  Androg" />
        <meta property="og:site_name" content="Androg" />
        <meta property="og:url" content="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" />

        

  
    <meta name="twitter:card" content="summary"/>
  
  
  <meta property="og:url" content="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/"/>
  <meta property="og:type" content="article"/>
  <meta property="og:title" content="Android Lifecycle関連コンポーネントについて - Androg"/>
  <meta property="og:description" content="はじめに Android Lifecycleのコードラボをやりつつ、ViewModelやLiveDataの仕組みを調べたのでメモしておこと思います。
https://codelabs.developers.google.com/codelabs/android-lifecycles
コードラボのコードベースでいろいろ試したソースはこちら
https://github.com/kwmt/android-lifecycles
Step1,2 ViewModel step1はアプリが起動したらタイマーがカウントアップし、画面回転するとタイマーのカウントがクリアされてしまう、という問題にViewModelというものを使ってどう対処するのかという話です。
ViewModelとは ViewModelを使えば、ActivityやFragmentのライフサイクル全体でデータを保持できます。 ActivityやFragmentは、ユーザーの操作でCreatedとDestroyedを繰り返す生存期間の短いオブジェクトです。
ViewModelクラスを作成するには、ViewModel()を継承します。（中身は空っぽですが）
class ChronoViewModel: ViewModel() { }  ViewModelは、ViewModelインスタンスが破棄されるときに呼ばれるonClearedというメソッドを持っています。
ViewModelインスタンスの取得方法 このViewModelインスタンスをActivityやFragmentで取得するには、
private val viewModel by viewModels&lt;ChronoViewModel&gt;()  のようにKotlin property delegateを使って取得するか、
viewModel = ViewModelProvider(this).get(ChronoViewModel::class.java)  このように取得することになります。
以前は、ViewModelProvider.of(activity)のように取得していましたが、lifecycleのバージョン2.2.0-alpha03からDeprecatedになっていました。 https://developer.android.com/jetpack/androidx/releases/lifecycle#2.2.0-alpha03
また、kotlin propertey Delegationを使うにはfragment-ktxの1.1.0以上を使う必要があります。
implementation &quot;androidx.fragment:fragment-ktx:1.1.0&quot;  https://developer.android.com/jetpack/androidx/releases/fragment#1.1.0
ViewModelの生存期間 ViewModelの生存期間はActivityやFragmentよりも長いです。 下図はActivityを起動して、画面を回転させ、バックボタンでアプリを終了したときの状態遷移です。
起動 onCreate viewModel created(正確にはLazyなのでアクセスしたタイミング) onStart onResume 回転 onPause onStop onDestroy onCreate onStart onResume バックボタンでアプリ終了 onPause onStop viewModel onCleared onDestroy  画面回転時に、ActivityはonDestroyされていますが、ViewModelはonClearedが呼ばれていません。"/>
  
  <meta name="twitter:title" content="Android Lifecycle関連コンポーネントについて - Androg"/>
  <meta name="twitter:description" content="はじめに Android Lifecycleのコードラボをやりつつ、ViewModelやLiveDataの仕組みを調べたのでメモしておこと思います。
https://codelabs.developers.google.com/codelabs/android-lifecycles
コードラボのコードベースでいろいろ試したソースはこちら
https://github.com/kwmt/android-lifecycles
Step1,2 ViewModel step1はアプリが起動したらタイマーがカウントアップし、画面回転するとタイマーのカウントがクリアされてしまう、という問題にViewModelというものを使ってどう対処するのかという話です。
ViewModelとは ViewModelを使えば、ActivityやFragmentのライフサイクル全体でデータを保持できます。 ActivityやFragmentは、ユーザーの操作でCreatedとDestroyedを繰り返す生存期間の短いオブジェクトです。
ViewModelクラスを作成するには、ViewModel()を継承します。（中身は空っぽですが）
class ChronoViewModel: ViewModel() { }  ViewModelは、ViewModelインスタンスが破棄されるときに呼ばれるonClearedというメソッドを持っています。
ViewModelインスタンスの取得方法 このViewModelインスタンスをActivityやFragmentで取得するには、
private val viewModel by viewModels&lt;ChronoViewModel&gt;()  のようにKotlin property delegateを使って取得するか、
viewModel = ViewModelProvider(this).get(ChronoViewModel::class.java)  このように取得することになります。
以前は、ViewModelProvider.of(activity)のように取得していましたが、lifecycleのバージョン2.2.0-alpha03からDeprecatedになっていました。 https://developer.android.com/jetpack/androidx/releases/lifecycle#2.2.0-alpha03
また、kotlin propertey Delegationを使うにはfragment-ktxの1.1.0以上を使う必要があります。
implementation &quot;androidx.fragment:fragment-ktx:1.1.0&quot;  https://developer.android.com/jetpack/androidx/releases/fragment#1.1.0
ViewModelの生存期間 ViewModelの生存期間はActivityやFragmentよりも長いです。 下図はActivityを起動して、画面を回転させ、バックボタンでアプリを終了したときの状態遷移です。
起動 onCreate viewModel created(正確にはLazyなのでアクセスしたタイミング) onStart onResume 回転 onPause onStop onDestroy onCreate onStart onResume バックボタンでアプリ終了 onPause onStop viewModel onCleared onDestroy  画面回転時に、ActivityはonDestroyされていますが、ViewModelはonClearedが呼ばれていません。"/>
  
  
  

    

        <title> Android Lifecycle関連コンポーネントについて &middot;  Androg</title>

    
        <meta name="description" content="" />
    

        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        

    
        <link href="https://kwmt27.net/index.xml" rel="alternate" type="application/rss+xml" title="Androg" />
    

    
        <link rel="canonical" href="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" />

    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Android Lifecycle関連コンポーネントについて",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "2019-09-19",
        "description": "",
        "wordCount": 600
    }
    </script>
    

    
    
    <link rel="stylesheet" href="https://kwmt27.net//css/crisp.css" type="text/css" />

    
    
    
    <script src="https://apis.google.com/js/platform.js" async defer>
      {lang: 'ja'}
    </script>

    
    <script data-ad-client="ca-pub-3131366896030715" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </head>
    <body>

        
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.5&appId=221529537867804";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
        </script>

        <header id="header">
            <a id="logo" href="https://kwmt27.net/"><img src="https://ja.gravatar.com/userimage/93860812/00b6ee3c5005fbd5ca9a4571908ce3ee.jpg?size=200" alt="Androg" /></a>
            <h1><a href="https://kwmt27.net/">Androg</a></h1>
            <p></p>

            <div id="follow-icons">
	
	<a href="http://twitter.com/kwmt27" rel="me"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	<a href="http://github.com/kwmt" rel="me"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="http://plus.google.com/+YasutakaKawamoto" rel="author"><i class="fa fa-google-plus-square fa-2x"></i></a>
	<a href="https://kwmt27.net/index.xml" rel="me"><i class="fa fa-rss-square fa-2x"></i></a> 
</div>  
            

            <div class="tags">
                <div>タグ</div>
                <span class="taglist">
                    
                        <a href="https://kwmt27.net//tags/1.2/">
                            <div>1.2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/1.2-rc1/">
                            <div>1.2-rc1<span class="badge">12</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/adb/">
                            <div>adb<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/advent-calendar/">
                            <div>advent-calendar<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/ambient/">
                            <div>ambient<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/android/">
                            <div>android<span class="badge">87</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/android-n/">
                            <div>android-n<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/android-studio/">
                            <div>android-studio<span class="badge">7</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/android-studio-3.6/">
                            <div>android-studio-3.6<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/android-wear/">
                            <div>android-wear<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/androiddevchallenge/">
                            <div>androiddevchallenge<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/androidstudio/">
                            <div>androidstudio<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/android%e7%a0%94%e7%a9%b6%e7%99%ba%e8%a1%a8%e4%bc%9a/">
                            <div>android研究発表会<span class="badge">3</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/animation/">
                            <div>animation<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/archive/zip/">
                            <div>archive/zip<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/arduino/">
                            <div>arduino<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/aws/">
                            <div>aws<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/beacon/">
                            <div>beacon<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/billing/">
                            <div>billing<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/bitmap/">
                            <div>bitmap<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/camera2/">
                            <div>camera2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/camerax/">
                            <div>camerax<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/cd/">
                            <div>cd<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/ci/">
                            <div>ci<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/ci/cd/">
                            <div>ci/cd<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/clean-architecture/">
                            <div>clean-architecture<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/cloud-vision-api/">
                            <div>cloud-vision-api<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/codelab/">
                            <div>codelab<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/compose/">
                            <div>compose<span class="badge">11</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/compress/bzip2/">
                            <div>compress/bzip2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/coroutine/">
                            <div>coroutine<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/css/">
                            <div>css<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/dagger2/">
                            <div>dagger2<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/dark-theme/">
                            <div>dark-theme<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/dart/">
                            <div>dart<span class="badge">5</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/dart2/">
                            <div>dart2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/databinding/">
                            <div>databinding<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/deeplearning/">
                            <div>deeplearning<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/delegate/">
                            <div>delegate<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/docker/">
                            <div>docker<span class="badge">3</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/eclipse/">
                            <div>eclipse<span class="badge">3</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/encoding/base64/">
                            <div>encoding/base64<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/encoding/json/">
                            <div>encoding/json<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/enum/">
                            <div>enum<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/fabric-sdk/">
                            <div>fabric-sdk<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/fcm/">
                            <div>fcm<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/firebase/">
                            <div>firebase<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/firestore/">
                            <div>firestore<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/flow/">
                            <div>flow<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/flutter/">
                            <div>flutter<span class="badge">28</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/flutter_inapp_purchase/">
                            <div>flutter_inapp_purchase<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/flutter_web/">
                            <div>flutter_web<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/gae/go/">
                            <div>gae/go<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/gcm/">
                            <div>gcm<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/gdgkobe/">
                            <div>gdgkobe<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/gds/">
                            <div>gds<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/genmai/">
                            <div>genmai<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/gin/">
                            <div>gin<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/git/">
                            <div>git<span class="badge">4</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/go/">
                            <div>go<span class="badge">4</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/gocon/">
                            <div>gocon<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/godoc/">
                            <div>godoc<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/golang/">
                            <div>golang<span class="badge">57</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/google&#43;api/">
                            <div>google&#43;api<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/google-i/o-2018/">
                            <div>google-i/o-2018<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/google-mapa-api/">
                            <div>google-mapa-api<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/google-maps-api/">
                            <div>google-maps-api<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/google-play/">
                            <div>google-play<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/google-signin/">
                            <div>google-signin<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/googlei/o-2019/">
                            <div>googlei/o-2019<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/googlemap/">
                            <div>googlemap<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/go%e8%a8%80%e8%aa%9e/">
                            <div>go言語<span class="badge">53</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/greendao/">
                            <div>greendao<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/heroku/">
                            <div>heroku<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/hugo/">
                            <div>hugo<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/icon/">
                            <div>icon<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/image/">
                            <div>image<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/intellij-idea/">
                            <div>intellij-idea<span class="badge">4</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/ios/">
                            <div>ios<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/java/">
                            <div>java<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/jenkins/">
                            <div>jenkins<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/jetpack/">
                            <div>jetpack<span class="badge">13</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/jquery/">
                            <div>jquery<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/json-schema/">
                            <div>json-schema<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/kotlin/">
                            <div>kotlin<span class="badge">7</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/kug2/">
                            <div>kug2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/layout/">
                            <div>layout<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/lifecycle/">
                            <div>lifecycle<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/line/">
                            <div>line<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/linebot/">
                            <div>linebot<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/lint/">
                            <div>lint<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/livedata/">
                            <div>livedata<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/lt/">
                            <div>lt<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/macos/">
                            <div>macos<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/map/">
                            <div>map<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/mockito2/">
                            <div>mockito2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/mysql/">
                            <div>mysql<span class="badge">4</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/navigation/">
                            <div>navigation<span class="badge">3</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/net/http/fcgi/">
                            <div>net/http/fcgi<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/net/smtp/">
                            <div>net/smtp<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/nginx/">
                            <div>nginx<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/node.js/">
                            <div>node.js<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/okhttp/">
                            <div>okhttp<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/openid/">
                            <div>openid<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/oreo/">
                            <div>oreo<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/package/">
                            <div>package<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/php/">
                            <div>php<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/pil/">
                            <div>pil<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/plant-uml/">
                            <div>plant-uml<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/polymer/">
                            <div>polymer<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/provider/">
                            <div>provider<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/push%e9%80%9a%e7%9f%a5/">
                            <div>push通知<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/python/">
                            <div>python<span class="badge">4</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/pythonchallenge/">
                            <div>pythonchallenge<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/reflect/">
                            <div>reflect<span class="badge">7</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/retrofit/">
                            <div>retrofit<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/retrofit2/">
                            <div>retrofit2<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/riot.js/">
                            <div>riot.js<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/room/">
                            <div>room<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/runtime/">
                            <div>runtime<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/rxjava/">
                            <div>rxjava<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/s3/">
                            <div>s3<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/sensor/">
                            <div>sensor<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/server/">
                            <div>server<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/sketch/">
                            <div>sketch<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/state/">
                            <div>state<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/statusbar/">
                            <div>statusbar<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/strconv/">
                            <div>strconv<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/strings/">
                            <div>strings<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/struct/">
                            <div>struct<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/sublime-text/">
                            <div>sublime-text<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/swift/">
                            <div>swift<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/swiftui/">
                            <div>swiftui<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/targetsdkversiion/">
                            <div>targetsdkversiion<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/template/">
                            <div>template<span class="badge">4</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/tensorflow/">
                            <div>tensorflow<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/test/">
                            <div>test<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/textformfield/">
                            <div>textformfield<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/topic/">
                            <div>topic<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/twitter/">
                            <div>twitter<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/unicode/utf8/">
                            <div>unicode/utf8<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/vagrant/">
                            <div>vagrant<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/view-binding/">
                            <div>view-binding<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/viewmodel/">
                            <div>viewmodel<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/volley/">
                            <div>volley<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/vps/">
                            <div>vps<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/web-api/">
                            <div>web-api<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/webview/">
                            <div>webview<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/wercker/">
                            <div>wercker<span class="badge">3</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/wercker-step/">
                            <div>wercker-step<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/windows/">
                            <div>windows<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/wordpress/">
                            <div>wordpress<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/xcode/">
                            <div>xcode<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/y/">
                            <div>y<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%82%a2%e3%83%97%e3%83%aa%e5%86%85%e8%aa%b2%e9%87%91/">
                            <div>アプリ内課金<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88/">
                            <div>イベント<span class="badge">9</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%82%a8%e3%83%9f%e3%83%a5%e3%83%ac%e3%83%bc%e3%82%bf/">
                            <div>エミュレータ<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%82%b7%e3%83%a7%e3%83%bc%e3%83%88%e3%82%ab%e3%83%83%e3%83%88%e3%82%ad%e3%83%bc/">
                            <div>ショートカットキー<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%82%b7%e3%83%b3%e3%82%bf%e3%83%83%e3%82%af%e3%82%b9%e3%83%8f%e3%82%a4%e3%83%a9%e3%82%a4%e3%83%88/">
                            <div>シンタックスハイライト<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab/">
                            <div>スクロール<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%83%88%e3%83%a9%e3%83%83%e3%82%af%e3%83%90%e3%83%83%e3%83%89/">
                            <div>トラックバッド<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%90%e3%82%b7%e3%83%bc%e3%83%9d%e3%83%aa%e3%82%b7%e3%83%bc/">
                            <div>プライバシーポリシー<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%83%a1%e3%83%ab%e3%83%81%e3%83%a3%e3%83%aa/">
                            <div>メルチャリ<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e3%83%a2%e3%83%90%e3%82%82%e3%81%8f%e4%bc%9a/">
                            <div>モバもく会<span class="badge">7</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e4%bd%93%e9%a8%93/">
                            <div>体験<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e5%8b%89%e5%bc%b7%e4%bc%9a/">
                            <div>勉強会<span class="badge">10</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e6%8c%af%e3%82%8a%e8%bf%94%e3%82%8a/">
                            <div>振り返り<span class="badge">8</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e6%97%85%e8%a1%8c%e8%a8%98/">
                            <div>旅行記<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e6%97%a5%e8%a8%98/">
                            <div>日記<span class="badge">13</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e6%a9%9f%e4%bc%9a%e5%ad%a6%e7%bf%92/">
                            <div>機会学習<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e6%a9%9f%e6%a2%b0%e5%ad%a6%e7%bf%92/">
                            <div>機械学習<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e7%99%bb%e5%a3%87/">
                            <div>登壇<span class="badge">2</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e7%bf%bb%e8%a8%b3/">
                            <div>翻訳<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e8%a7%92%e4%b8%b8/">
                            <div>角丸<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e8%a8%ad%e5%ae%9a%e5%88%87%e3%82%8a%e6%9b%bf%e3%81%88/">
                            <div>設定切り替え<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e9%96%a2%e3%83%a2%e3%83%90/">
                            <div>関モバ<span class="badge">1</span></div>
                        </a>
                    
                        <a href="https://kwmt27.net//tags/%e9%98%aago/">
                            <div>阪go<span class="badge">2</span></div>
                        </a>
                    
                </span>
            </div>


        </header>

<main id="content">

<article id="" class="post">
    <div class="post-stamp">
        <time datetime="2019-09-19T21:10:00&#43;09:00">
            19 Sep 2019
        </time>
        <span class="taglist">
        
        &middot; 
        
            <a href="https://kwmt27.net/tags/android/">Android</a>
        
            <a href="https://kwmt27.net/tags/kotlin/">Kotlin</a>
        
            <a href="https://kwmt27.net/tags/lifecycle/">Lifecycle</a>
        
            <a href="https://kwmt27.net/tags/viewmodel/">ViewModel</a>
        
            <a href="https://kwmt27.net/tags/livedata/">LiveData</a>
        
        
        </span>
    </div>
    <h1 class="post-title">Android Lifecycle関連コンポーネントについて</h1>

    <div id="share-top">
    <ul class="clearfix">
        
        <li>
            <a href="http://b.hatena.ne.jp/entry/https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" class="hatena-bookmark-button"
               data-hatena-bookmark-title="Android Lifecycle関連コンポーネントについて" data-hatena-bookmark-layout="standard-balloon"
               data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img
                    src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加"
                    width="20" height="20" style="border: none;"/></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8"
                    async="async"></script>

        </li>
        
        
        <li>
            <div class="g-plusone" data-href="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/"></div>
        </li>

        
        <li>

            <div class="fb-like" data-href="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" data-layout="button_count" data-action="like"
                 data-show-faces="false" data-share="false"></div>
        </li>

        
        <li>
            <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
            <script type="text/javascript">
                !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
            </script>
        </li>

    </ul>
</div>
    <div id="ad">
    <aside>
        <p>スポンサーリンク</p>
        <div class="responsive-unit">
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3131366896030715"
                 data-ad-slot="5415567707"
                 data-ad-format="auto"></ins>
            <script>
(adsbygoogle = window.adsbygoogle || []).push({});

            </script>
        </div>
    </aside>
</div>
    

<h1 id="はじめに">はじめに</h1>

<p>Android Lifecycleのコードラボをやりつつ、ViewModelやLiveDataの仕組みを調べたのでメモしておこと思います。</p>

<p><a href="https://codelabs.developers.google.com/codelabs/android-lifecycles">https://codelabs.developers.google.com/codelabs/android-lifecycles</a></p>

<p>コードラボのコードベースでいろいろ試したソースはこちら</p>

<p><a href="https://github.com/kwmt/android-lifecycles">https://github.com/kwmt/android-lifecycles</a></p>

<h1 id="step1-2-viewmodel">Step1,2 ViewModel</h1>

<p>step1はアプリが起動したらタイマーがカウントアップし、画面回転するとタイマーのカウントがクリアされてしまう、という問題にViewModelというものを使ってどう対処するのかという話です。</p>

<h2 id="viewmodelとは">ViewModelとは</h2>

<p><a href="https://developer.android.com/reference/android/arch/lifecycle/ViewModel.html">ViewModel</a>を使えば、ActivityやFragmentのライフサイクル全体でデータを保持できます。
ActivityやFragmentは、ユーザーの操作でCreatedとDestroyedを繰り返す生存期間の短いオブジェクトです。</p>

<p>ViewModelクラスを作成するには、<code>ViewModel()</code>を継承します。（中身は空っぽですが）</p>

<pre><code class="language-kotlin">class ChronoViewModel: ViewModel() {
}
</code></pre>

<p><code>ViewModel</code>は、ViewModelインスタンスが破棄されるときに呼ばれる<code>onCleared</code>というメソッドを持っています。</p>

<h3 id="viewmodelインスタンスの取得方法">ViewModelインスタンスの取得方法</h3>

<p>このViewModelインスタンスをActivityやFragmentで取得するには、</p>

<pre><code class="language-kotlin">private val viewModel by viewModels&lt;ChronoViewModel&gt;()
</code></pre>

<p>のようにKotlin property delegateを使って取得するか、</p>

<pre><code class="language-kotlin">viewModel = ViewModelProvider(this).get(ChronoViewModel::class.java)
</code></pre>

<p>このように取得することになります。</p>

<p>以前は、<code>ViewModelProvider.of(activity)</code>のように取得していましたが、lifecycleのバージョン2.2.0-alpha03からDeprecatedになっていました。
<a href="https://developer.android.com/jetpack/androidx/releases/lifecycle#2.2.0-alpha03">https://developer.android.com/jetpack/androidx/releases/lifecycle#2.2.0-alpha03</a></p>

<p>また、kotlin propertey Delegationを使うにはfragment-ktxの1.1.0以上を使う必要があります。</p>

<pre><code class="language-gradle">implementation &quot;androidx.fragment:fragment-ktx:1.1.0&quot;
</code></pre>

<p><a href="https://developer.android.com/jetpack/androidx/releases/fragment#1.1.0">https://developer.android.com/jetpack/androidx/releases/fragment#1.1.0</a></p>

<h2 id="viewmodelの生存期間">ViewModelの生存期間</h2>

<p>ViewModelの生存期間はActivityやFragmentよりも長いです。
下図はActivityを起動して、画面を回転させ、バックボタンでアプリを終了したときの状態遷移です。</p>

<pre><code>起動
    onCreate
        viewModel created(正確にはLazyなのでアクセスしたタイミング)
    onStart
    onResume
回転
    onPause
    onStop
    onDestroy
    onCreate
    onStart
    onResume
バックボタンでアプリ終了
    onPause
    onStop
        viewModel onCleared
    onDestroy
</code></pre>

<p>画面回転時に、Activityは<code>onDestroy</code>されていますが、ViewModelは<code>onCleared</code>が呼ばれていません。</p>

<h2 id="viewmodelの仕組み">ViewModelの仕組み</h2>

<p>ここで、</p>

<ol>
<li>ViewModelがどのような仕組みで保持されているか</li>
<li>画面回転時にも<code>onDestroy</code>が呼ばれているにも関わらず<code>onCleared</code>は呼ばれず、アプリ終了時にのみ<code>onCleared</code>が呼ばれている仕組み</li>
</ol>

<p>をみてみます。</p>

<h3 id="1-viewmodelがどのような仕組みで保持されているか">1. ViewModelがどのような仕組みで保持されているか</h3>

<p>まず、Activityは</p>

<pre><code>ChronoActivity -&gt; AppCompatActivty -&gt; FragmentActivity -&gt; ComponentActivity -&gt; Activity
</code></pre>

<p>このような継承関係になっています。</p>

<p>おそらく<code>ActivityThread</code>クラスにあるstaticな<code>sCurrentActivityThread</code>変数がActivityが破棄されても同じインスタンスが取得できる大元のインスタンスだと思います。(これは間違っている可能性大です・・・（汗）)
<a href="https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#351">https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#351</a></p>

<ul>
<li>アプリ起動時</li>
</ul>

<p>onCreate時に<code>ActivityThread</code>の<code>mActivities</code>に<code>ActivityClientRecord</code>(Activity含む)を保持します。
<a href="https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#3260">https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#3260</a></p>

<ul>
<li>画面回転し始めからonDestroyまで</li>
</ul>

<p>Configurationの変更が発生（画面が回転やシステムの言語変更）すると、
<code>onSaveInstanceState</code>で最後の構成状態<code>lastNonConfigurationInstances</code>を取得して保持し、<code>onDestroy</code>になります。
<a href="https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#4913">https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#4913</a></p>

<ul>
<li>再生成(onCreate)</li>
</ul>

<p><code>onCreate</code>時に<code>ActivityThread</code>の<code>mActivies</code>の保持しておいた<code>ActivityClientRecord</code>インスタンスを取得して、そこに<code>lastNonConfigurationInstances</code>という最後の構成状態を取得し、<code>Activity</code>の<code>mLastNonConfigurationInstances</code>にセットします。
<a href="https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/Activity.java#7738">https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/Activity.java#7738</a></p>

<p><code>ComponentActivity#getViewModelStore()</code>が呼ばれ、内部で<code>getLastNonConfigurationInstance()</code>が呼ばれていて、
<a href="https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/activity/activity/src/main/java/androidx/activity/ComponentActivity.java#187">https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/activity/activity/src/main/java/androidx/activity/ComponentActivity.java#187</a></p>

<p>これは<code>mLastNonConfigurationInstances</code>がnullでなければ<code>mLastNonConfigurationInstances.activity</code>(これがViewModelの実態)を返すようになっています。
<a href="https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/Activity.java#2876">https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/Activity.java#2876</a></p>

<p>自分のActivityでviewModelをインスタンスにアクセスするとき、<code>ComponentActivity#getViewModelStore()</code>が呼ばれ、ViewModelはキャッシュされているものを返す仕組みになっています。</p>

<h3 id="2-画面回転時にも-ondestroy-が呼ばれているにも関わらず-oncleared-は呼ばれず-アプリ終了時にのみ-oncleared-が呼ばれている仕組み">2. 画面回転時にも<code>onDestroy</code>が呼ばれているにも関わらず<code>onCleared</code>は呼ばれず、アプリ終了時にのみ<code>onCleared</code>が呼ばれている仕組み</h3>

<p>画面回転時に、Activityのメンバ変数<code>mChangingConfigurations</code>に<code>true</code>がセットされます。
<a href="https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#5165">https://android.googlesource.com/platform/frameworks/base.git/+/refs/heads/android10-release/core/java/android/app/ActivityThread.java#5165</a></p>

<p>LifecycleのState変更が監視されていて、<code>onDestroy</code>にStateが変わると、onStateChengedが呼ばれて、<code>mChangingConfigurations</code>を返すメソッド <code>isChangingConfigurations()</code>で画面回転中か確認し、true(回転中)なら何もぜず、false(回転中ではないonDestory=Activity終了)なら、<code>onCleared</code>メソッドを呼ぶという仕組みになっています。
<a href="https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/activity/activity/src/main/java/androidx/activity/ComponentActivity.java#118">https://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/activity/activity/src/main/java/androidx/activity/ComponentActivity.java#118</a></p>

<h2 id="画面回転でもタイマーリセットされないように変更する">画面回転でもタイマーリセットされないように変更する</h2>

<p>ViewModelはActivityより生存期間が長いことがわかりましたので、ViewModelに保持したいタイマーの時間を保持します。</p>

<pre><code class="language-kotlin">class ChronoViewModel : ViewModel() {
    var startTime: Long? = null
}
</code></pre>

<p>Activity側ではonCreate時に、startTimeがnullなら時間を新規にセットして、nullじゃない（回転時）なら、ViewModelのstartTimeをセットすればよいです。</p>

<p>Activity側のコードは<a href="https://github.com/googlecodelabs/android-lifecycles/blob/master/app/src/main/java/com/example/android/lifecycles/step2/ChronoActivity2.java#L41-L50">Step2</a>のコードをKotlinで書いただけなので割愛。そういう意味ではViewModelもそうなのですが、ポイントはViewModelの方なので。</p>

<h1 id="step3-livedata">Step3 LiveData</h1>

<p>次は<code>Timer</code>クラスを使って、UIを1秒間隔で「~秒経過」と表示するということを考えます。</p>

<h2 id="画面回転でメモリリークしない">画面回転でメモリリークしない？</h2>

<p>ちょっとその前に気になることが、、、</p>

<blockquote>
<p>To help avoid memory leaks, the ViewModel doesn&rsquo;t include references to the activity. For example, a configuration change, such as a screen rotation, might result in references in a ViewModel to an activity that should be garbage collected</p>

<p>メモリリークを避けるために、ViewModelにAactivityの参照を持たないようにしてください。
たとえば、画面回転などのコンフィグ変更すると、GCすべきActivityの参照が破棄されないかもしれません。</p>
</blockquote>

<p>と書いてるんですが、画面回転ではメモリリークしませんでした。</p>

<p>ViewModelはActivityをもたせて</p>

<pre><code class="language-kotlin">class ChronoViewModel : ViewModel() {
    var activity: ChronoActivity? = null
}
</code></pre>

<p>ActivityでViewModelのactivityに自分自身をセットし</p>

<pre><code class="language-kotlin">override fun onCreate(savedInstanceState: Bundle?) {
    // 省略
    viewModel.activity = this
}    
</code></pre>

<p>画面回転させたところ、LeakCanaryは検知しませんでした。(API level 29で確認しました。)</p>

<p>しかし、アプリ終了でリークしました。</p>

<pre><code>    ├─ com.example.android.lifecycles.practice.ChronoViewModel
    │    Leaking: UNKNOWN
    │    ↓ ChronoViewModel.activity
    │                      ~~~~~~~~
    ╰→ com.example.android.lifecycles.practice.ChronoActivity
    ​     Leaking: YES (Activity#mDestroyed is true and ObjectWatcher was watching this)
    ​     key = b9316fdf-3fe3-406a-b73e-d63d68a42b2a
    ​     watchDurationMillis = 5193
    ​     retainedDurationMillis = 152
</code></pre>

<p>まぁメモリリークはするので、ViewModelでActivityやViewの参照はするべきではないと理解。</p>

<p>ホントはViewModelにViewを渡して、次のような感じでViewModelでViewを更新できたら良かったんでしょうけど、上記の通りメモリリークするので、Activity側でUIを更新しないといけないので、それをどうするかっていうのがstep3の<a href="https://developer.android.com/reference/android/arch/lifecycle/LiveData"><code>LiveData</code></a>を使いましょうというお話。</p>

<pre><code class="language-kotlin">class ChronoViewModel : ViewModel() {
    var timerTextView: TextView? = null

    init{ 
        // 毎秒ごとに更新できない
        timerTextView.text = &quot;$秒数 秒経過&quot;
    }
}
</code></pre>

<h2 id="本題に戻ります">本題に戻ります！</h2>

<p>UIを1秒間隔で更新したいということでしたね。</p>

<p>まず、LiveDataに値を設定できる<code>MutableLiveData</code>とそれをLiveDataとして返す関数を作成します。</p>

<pre><code class="language-kotlin">private val elapsedTime = MutableLiveData&lt;Long&gt;()
fun getElapsedTime(): LiveData&lt;Long&gt; = elapsedTime
</code></pre>

<p>そして、1秒毎に更新したいので、Timerクラスを使って実装します。</p>

<pre><code class="language-kotlin">class ChronoViewModel : ViewModel() {

    private val elapsedTime = MutableLiveData&lt;Long&gt;()
    fun getElapsedTime(): LiveData&lt;Long&gt; = elapsedTime

    private val initialTime = SystemClock.elapsedRealtime()
    private val timer = Timer()

    init {
        timer.scheduleAtFixedRate(object : TimerTask() {
            override fun run() {
                val newValue = (SystemClock.elapsedRealtime() - initialTime) / 1000;
            }
        }, 1000, 1000)
    }
}
</code></pre>

<p>ここまで来ると、なんとなく<code>newValue</code>をMutableLiveDataの<code>elapsedTime</code>にセットするんだなって思うと思うので、セットします。</p>

<pre><code class="language-kotlin">val newValue = (SystemClock.elapsedRealtime() - initialTime) / 1000;
elapsedTime.value = newValue
</code></pre>

<p>すると、<code>setValue</code>はバックグラウンドスレッドで呼び出すことができないエラーが出ます。</p>

<pre><code>java.lang.IllegalStateException: Cannot invoke setValue on a background thread
    at androidx.lifecycle.LiveData.assertMainThread(LiveData.java:462)
    at androidx.lifecycle.LiveData.setValue(LiveData.java:304)
    at androidx.lifecycle.MutableLiveData.setValue(MutableLiveData.java:50)
    at com.example.android.lifecycles.practice.ChronoViewModel$1.run(ChronoViewModel.kt:25)
    at java.util.TimerThread.mainLoop(Timer.java:562)
    at java.util.TimerThread.run(Timer.java:512)
</code></pre>

<p>じゃぁどうするかとというと、<a href="https://developer.android.com/reference/android/arch/lifecycle/MutableLiveData.html#postValue(T)"><code>postValue</code></a>を使います。</p>

<p>なぜ<code>setValue</code>はメインスレッド以外禁止にしているかというと、そもそもViewModelにViewを持たせて、ViewModelでUIを更新したかったけど、リークするのでできないから、LiveDataを使いましょうという話だったので、LiveDataの役割はViewを更新することでした。</p>

<p>であるならば、Viewの更新はメインスレッドでしかできないので、<code>setValue</code>するときはメインスレッド以外で呼ぶのを禁止しましょう、ってなったんだと思います。(あ、UI側で<code>onChanged</code>メソッドを実装することになるので、<code>setValue</code>はそれを呼び出したスレッドで<code>onChanged</code>メソッドが呼ばれます。)
使う側で毎回 メインのHandlerのpostするのは面倒ですしね。</p>

<p>で、<code>postValue</code>はなぜメインスレッド以外で呼べるかというと、名前からもわかるように次のように実装されているからです。</p>

<pre><code class="language-java">mMainHandler.post(runnable);
</code></pre>

<p>runnableは下記</p>

<pre><code class="language-java">private final Runnable mPostValueRunnable = new Runnable() {
    @SuppressWarnings(&quot;unchecked&quot;)
    @Override
    public void run() {
        Object newValue;
        synchronized (mDataLock) {
            newValue = mPendingData;
            mPendingData = NOT_SET;
        }
        setValue((T) newValue);
    }
};
</code></pre>

<p>ぜんぶ<code>postValue</code>使ったら、使う側でスレッド意識しなくていいから、ぜんぶ<code>postValue</code>じゃダメなんですかね？<br />
という疑問が最近あるのですが。。。</p>

<p>さて、ViewModel側でMutableLiveDataにpostValue()するところまで来ました。
まだUIを更新していませんので、次にActivityをみていきます。</p>

<p>Activityで、ViewModelのelapsedTime(MutableLiveData)を使って、</p>

<pre><code class="language-kotlin">viewModel.elapsedTime.value
</code></pre>

<p>でpostValueされたデータは取得できます。しかし、今回は毎秒ごとに更新したいので、そのためにはLiveDataを監視するという実装が必要になります。具体的には次のようになります。</p>

<pre><code class="language-kotlin">viewModel.getElapsedTime().observe(this, object : Observer&lt;Long&gt; {
    override fun onChanged(t: Long?) {
        timerTextView.text = &quot;${t}秒経過&quot;
    }
})
</code></pre>

<p><code>viewModel.getElapsedTime()</code>でLiveDataを取得して、それに対して<code>observe</code>メソッドで監視します。
ViewModelのMutableLiveDataが<code>postValue</code>されたら、<code>onChanged</code>メソッドが実行され、TextViewを更新するという流れなります。</p>

<p>余計なViewが入っていますが、実行することこうなります。</p>

<p><img src="/images/2019/09/android-lifecycle-codelab/livedata.gif" width="300"></p>

<p>もう少しだけ補足が必要で、まず<code>viewModel.getElapsedTime()</code>は、<code>MutableLiveData</code>ではなく<code>LiveData</code>を返します。これは、Activity側では更新する必要がないため、不必要な更新ができてしまうことさけるためにこのようにしています。</p>

<p>次に、<code>observe</code>メソッドの第一引数に渡している<code>this</code>は、<code>LifecycleOwner</code>を渡しています。
このコードラボでは<code>LifecycleRegistryOwner</code>となっていますが、<a href="https://developer.android.com/reference/android/arch/lifecycle/LifecycleRegistryOwner.html">version 1.1.0でDeprecatedになっていました</a>。</p>

<p><code>LifecycleOwner</code>はViewModelとLiveDetaのライフサイクルをバインドするためのもので、ChronoActivityの親クラスの<code>ComponentActivity</code>が実装しているインターフェースです。</p>

<pre><code class="language-java">class ChronoActivity extends AppCompatActivity extends FragmentActivity extends ComponentActivity extends androidx.core.app.ComponentActivity implements LifecycleOwner
</code></pre>

<p>注意）Activityがアクティブな状態でないと、UIは更新されないことに注意してください。
仕組み的にはアクティブになっていない場合は、<code>onChanged</code>が呼ばれ無いだけです。</p>

<p>LiveDataのprivateメソッドに次のようなものがあり、<code>if (!observer.mActive)</code>で判断しています。</p>

<pre><code class="language-java">private void considerNotify(ObserverWrapper observer) {
    if (!observer.mActive) {
        return;
    }
    if (!observer.shouldBeActive()) {
        observer.activeStateChanged(false);
        return;
    }
    if (observer.mLastVersion &gt;= mVersion) {
        return;
    }
    observer.mLastVersion = mVersion;
    observer.mObserver.onChanged((T) mData);
}
</code></pre>

<p>ちなみに、Activityがアクティブでないときも<code>onChanged</code>を呼びたい場合は、<a href="https://developer.android.com/reference/android/arch/lifecycle/LiveData.html#observeForever(android.arch.lifecycle.Observer&lt;T&gt;)"><code>observeForever</code></a>というメソッドが用意されてるので、そちらを使うと良さそうです。</p>

<p>また、observeの実装を説明のためにObserverのインターフェース実装のような形で書きましたが、次のようにlambdaを使って書くと少しスッキリします。</p>

<pre><code class="language-kotlin">viewModel.getElapsedTime().observe(this, Observer {
    timerTextView.text = &quot;${it}秒経過&quot;
})
</code></pre>

<p>これでstep3は終了です。</p>

<h1 id="step4-lifecycle">step4 Lifecycle</h1>

<p>たとえば、現在地を取得するためには <a href="https://developer.android.com/reference/kotlin/android/location/LocationManager"><code>LocationManager</code></a>を使うと思います。
このようなAPIは、使うために初期化したりsubscribeしたりし、使わなくなったらストップしたり、unsubscribeします。</p>

<pre><code class="language-java">@Override
protected void onResume() {
    mLocationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, mListener);
}

@Override
protected void onPause() {
    mLocationManager.removeUpdates(mListener);
}
</code></pre>

<p>AndroidのライブラリやAPIはこのような処理をすることが多く、ActivityやFragmentで処理を書くと煩雑になってしまい、読みにくくなってしまいます。このようなことを防ぐために<a href="https://developer.android.com/topic/libraries/architecture/lifecycle"><code>Lifecycle</code></a>を使うと便利ですよ、という話になります。</p>

<p>簡単に言うと、ActivityやFragment以外のクラスでライフサイクルの変更を検知することができます。
このコードラボでは、<code>BoundLocationListener</code>クラスがライフサイクルの変更を検知できるようになる予定なのですが、どのような仕組みかというと、まず<code>BoundLocationListener</code>にActivityの<code>lifecycleOwner</code>インスタンスを渡して、Lifecycleを次のように監視します。(<code>lifecycleOwner</code>は<code>ComponentActivity</code>が実装しているインターフェースでしたね)</p>

<pre><code class="language-kotlin">lifecycleOwner.lifecycle.addObserver(this)
</code></pre>

<p>このときの<code>this</code>は<code>LifecycleObserver</code>インターフェースで、<code>BoundLocationListener</code>が実装する必要があります。（といっても特に実装するものはありません）</p>

<p>次に、ライフサイクルが変更したときに指定したメソッドをコールするには、次のように<code>@OnLifecycleEvent</code>アノテーションを付けます。</p>

<pre><code class="language-kotlin">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)
fun addLocationListener() {
    ・・・　
}
@OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)
fun removeLocationListener() {
    ・・・　
}
</code></pre>

<p>これだけで、ActivityやFragmentのライフサイクルと連動できるなんて、超便利そうですね！
ちなみに、軽く内部実装みたら、リフレクション使ってますね。まぁそりゃそうかという感じですが。</p>

<p>ここで少し気になるのが、<code>init</code>で<code>addObserver(this)</code>としているから、デストラクタとかで<code>removeObserver(this)</code>としなくていいのかということです。</p>

<p>調べたところ、<code>removeObserver</code>はしなくて良いそうです。</p>

<p><a href="https://github.com/googlecodelabs/android-lifecycles/issues/5">https://github.com/googlecodelabs/android-lifecycles/issues/5</a></p>

<p>内部実装をみると、onDestroy時に<code>removeObserver</code>が呼ばれていました。</p>

<h1 id="step5-viewmodelの共有">step5 ViewModelの共有</h1>

<p>次はViewModelがFramgment間や、FragmentとActivity間でシェアできるよというお話。</p>

<p>１つのActivityに２つのシークバーを持つFragmentが上下に並んでいて、ViewModelを使うと、片方のシークバーを移動したときにもう片方のシークバーも同期的に動くようにできるらしい。</p>

<p>ViewModelインスタンスを取得する際、FragmentのLifecycleOwnerを渡すのではなく、Fragmentが属しているActivityのLifecycleOwnerを渡してあげれば良いようです。</p>

<p>いままでは次のようにViewModelインスタンスを取得していた。</p>

<pre><code class="language-kotlin">private val viewModel by viewModels&lt;ChronoViewModel&gt;()
</code></pre>

<p>これは、実装を見ればわかりますが、Fragment自身のLifecycleOwnerを渡していました。</p>

<p>以下の <code>{this}</code>のところ。</p>

<pre><code class="language-kotlin">@MainThread
inline fun &lt;reified VM : ViewModel&gt; Fragment.viewModels(
    noinline ownerProducer: () -&gt; ViewModelStoreOwner = { this },
    noinline factoryProducer: (() -&gt; Factory)? = null
) = createViewModelLazy(VM::class, { ownerProducer().viewModelStore }, factoryProducer)
</code></pre>

<p>この部分をFragmentではなくActivityに変えたら良いので、次のように<code>{ requireActivity() }</code>を渡してあげます。</p>

<pre><code class="language-kotlin">private val viewModel: SeekBarViewModel by viewModels({ requireActivity() })
</code></pre>

<p>あとは、シークバーの変更時に、LiveDataの値を更新してあげて</p>

<pre><code class="language-kotlin">override fun onProgressChanged(seekBar: SeekBar, progress: Int, fromUser: Boolean) {
    mSeekBarViewModel.seekbarValue.value = progress
}
</code></pre>

<p>その更新するLiveDataを監視して、シークバーの値を更新してあげると、</p>

<pre><code class="language-kotlin">mSeekBarViewModel.seekbarValue.observe(viewLifecycleOwner, Observer {
    mSeekBar?.progress = it
})
</code></pre>

<p>次のような動画のように、片方動かすと片方も動くようになります。</p>

<p><img src="/images/2019/09/android-lifecycle-codelab/share_viewmodel.gif" width="300"></p>

<h1 id="まとめ">まとめ</h1>

<ul>
<li>ViewModelはActivityやFragmentより、生存期間が長いので、画面回転などのActivity再生成でも回転前と後で値を保持できる。</li>
<li>LiveDataを使って、ViewModelでの更新をActivityやFragmentに通知できる。</li>
<li>LifecycleはActivityやFragment以外のクラスでライフサイクル管理ができるので、ActivityやFragment生成時にsubscribeし、破棄時にunsubscribeするようなコンポーネントで使うとスッキリできる。</li>
<li>ViewModelはFragment間やFragmentとActivity間で共有できる。</li>
</ul>

    <div id="ad">
    <aside>
        <p>スポンサーリンク</p>
        <div class="responsive-unit">
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3131366896030715"
                 data-ad-slot="5415567707"
                 data-ad-format="auto"></ins>
            <script>
(adsbygoogle = window.adsbygoogle || []).push({});

            </script>
        </div>
    </aside>
</div>
    <div id="share-top">
    <ul class="clearfix">
        
        <li>
            <a href="http://b.hatena.ne.jp/entry/https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" class="hatena-bookmark-button"
               data-hatena-bookmark-title="Android Lifecycle関連コンポーネントについて" data-hatena-bookmark-layout="vertical-balloon"
               data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img
                    src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加"
                    width="20" height="20" style="border: none;"/></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8"
                    async="async"></script>

        </li>
        
        
        <li>
            <div class="g-plusone" data-size="tall" data-href="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/"></div>
        </li>

        
        <li>

            <div class="fb-like" data-href="https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" data-layout="box_count" data-action="like"
                 data-show-faces="false" data-share="false"></div>
        </li>

        
        <li>
            <a data-pocket-label="pocket" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
            <script type="text/javascript">
                !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
            </script>
        </li>

    </ul>
</div>
    <div id="social-bar">
	<ul class="rrssb-buttons clearfix">
      <li class="email">
          <a href="mailto:?subject=Android%20Lifecycle%e9%96%a2%e9%80%a3%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&amp;body=https://kwmt27.net/2019/09/19/android-lifecycle-codelab/">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path transform="scale(0.014,-0.014) translate(0,-1670)" d="M1792 826v-794q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v794q44 -49 101 -87q362 -246 497 -345q57 -42 92.5 -65.5t94.5 -48t110 -24.5h1h1q51 0 110 24.5t94.5 48t92.5 65.5q170 123 498 345q57 39 100 87zM1792 1120q0 -79 -49 -151t-122 -123 q-376 -261 -468 -325q-10 -7 -42.5 -30.5t-54 -38t-52 -32.5t-57.5 -27t-50 -9h-1h-1q-23 0 -50 9t-57.5 27t-52 32.5t-54 38t-42.5 30.5q-91 64 -262 182.5t-205 142.5q-62 42 -117 115.5t-55 136.5q0 78 41.5 130t118.5 52h1472q65 0 112.5 -47t47.5 -113z"/>
                  </svg>
              </span>
              <span class="text">Email</span>
          </a>
      </li>
      <li class="facebook">
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434 c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726 c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
                  </svg>
              </span>
              <span class="text">Facebook</span>
          </a>
      </li>
			<li class="twitter">
          <a href="http://twitter.com/home?status=Android%20Lifecycle%e9%96%a2%e9%80%a3%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%20https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32 c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155 C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965 C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683 c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851 C26.275,7.229,25.39,8.196,24.253,8.756z"/>
                  </svg>
              </span>
              <span class="text">Twitter</span>
          </a>
      </li>
			<li class="linkedin">
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://kwmt27.net/2019/09/19/android-lifecycle-codelab/&amp;title=Android%20Lifecycle%e9%96%a2%e9%80%a3%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&amp;summary=%e3%81%af%e3%81%98%e3%82%81%e3%81%ab%20Android%20Lifecycle%e3%81%ae%e3%82%b3%e3%83%bc%e3%83%89%e3%83%a9%e3%83%9c%e3%82%92%e3%82%84%e3%82%8a%e3%81%a4%e3%81%a4%e3%80%81ViewModel%e3%82%84LiveData%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%82%92%e8%aa%bf%e3%81%b9%e3%81%9f%e3%81%ae%e3%81%a7%e3%83%a1%e3%83%a2%e3%81%97%e3%81%a6%e3%81%8a%e3%81%93%e3%81%a8%e6%80%9d%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0ahttps%3a%2f%2fcodelabs.developers.google.com%2fcodelabs%2fandroid-lifecycles%0a%e3%82%b3%e3%83%bc%e3%83%89%e3%83%a9%e3%83%9c%e3%81%ae%e3%82%b3%e3%83%bc%e3%83%89%e3%83%99%e3%83%bc%e3%82%b9%e3%81%a7%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e8%a9%a6%e3%81%97%e3%81%9f%e3%82%bd%e3%83%bc%e3%82%b9%e3%81%af%e3%81%93%e3%81%a1%e3%82%89%0ahttps%3a%2f%2fgithub.com%2fkwmt%2fandroid-lifecycles%0aStep1%2c2%20ViewModel%20step1%e3%81%af%e3%82%a2%e3%83%97%e3%83%aa%e3%81%8c%e8%b5%b7%e5%8b%95%e3%81%97%e3%81%9f%e3%82%89%e3%82%bf%e3%82%a4%e3%83%9e%e3%83%bc%e3%81%8c%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e3%81%97%e3%80%81%e7%94%bb%e9%9d%a2%e5%9b%9e%e8%bb%a2%e3%81%99%e3%82%8b%e3%81%a8%e3%82%bf%e3%82%a4%e3%83%9e%e3%83%bc%e3%81%ae%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%8c%e3%82%af%e3%83%aa%e3%82%a2%e3%81%95%e3%82%8c%e3%81%a6%e3%81%97%e3%81%be%e3%81%86%e3%80%81%e3%81%a8%e3%81%84%e3%81%86%e5%95%8f%e9%a1%8c%e3%81%abViewModel%e3%81%a8%e3%81%84%e3%81%86%e3%82%82%e3%81%ae%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%e3%81%a9%e3%81%86%e5%af%be%e5%87%a6%e3%81%99%e3%82%8b%e3%81%ae%e3%81%8b%e3%81%a8%e3%81%84%e3%81%86%e8%a9%b1%e3%81%a7%e3%81%99%e3%80%82%0aViewModel%e3%81%a8%e3%81%af%20ViewModel%e3%82%92%e4%bd%bf%e3%81%88%e3%81%b0%e3%80%81Activity%e3%82%84Fragment%e3%81%ae%e3%83%a9%e3%82%a4%e3%83%95%e3%82%b5%e3%82%a4%e3%82%af%e3%83%ab%e5%85%a8%e4%bd%93%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e6%8c%81%e3%81%a7%e3%81%8d%e3%81%be%e3%81%99%e3%80%82%20Activity%e3%82%84Fragment%e3%81%af%e3%80%81%e3%83%a6%e3%83%bc%e3%82%b6%e3%83%bc%e3%81%ae%e6%93%8d%e4%bd%9c%e3%81%a7Created%e3%81%a8Destroyed%e3%82%92%e7%b9%b0%e3%82%8a%e8%bf%94%e3%81%99%e7%94%9f%e5%ad%98%e6%9c%9f%e9%96%93%e3%81%ae%e7%9f%ad%e3%81%84%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%a7%e3%81%99%e3%80%82%0aViewModel%e3%82%af%e3%83%a9%e3%82%b9%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%80%81ViewModel%28%29%e3%82%92%e7%b6%99%e6%89%bf%e3%81%97%e3%81%be%e3%81%99%e3%80%82%ef%bc%88%e4%b8%ad%e8%ba%ab%e3%81%af%e7%a9%ba%e3%81%a3%e3%81%bd%e3%81%a7%e3%81%99%e3%81%8c%ef%bc%89%0aclass%20ChronoViewModel%3a%20ViewModel%28%29%20%7b%20%7d%20%20ViewModel%e3%81%af%e3%80%81ViewModel%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%81%8c%e7%a0%b4%e6%a3%84%e3%81%95%e3%82%8c%e3%82%8b%e3%81%a8%e3%81%8d%e3%81%ab%e5%91%bc%e3%81%b0%e3%82%8c%e3%82%8bonCleared%e3%81%a8%e3%81%84%e3%81%86%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e6%8c%81%e3%81%a3%e3%81%a6%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0aViewModel%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%81%ae%e5%8f%96%e5%be%97%e6%96%b9%e6%b3%95%20%e3%81%93%e3%81%aeViewModel%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92Activity%e3%82%84Fragment%e3%81%a7%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%80%81%0aprivate%20val%20viewModel%20by%20viewModels%26lt%3bChronoViewModel%26gt%3b%28%29%20%20%e3%81%ae%e3%82%88%e3%81%86%e3%81%abKotlin%20property%20delegate%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b%e3%81%8b%e3%80%81%0aviewModel%20%3d%20ViewModelProvider%28this%29.get%28ChronoViewModel%3a%3aclass.java%29%20%20%e3%81%93%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%81%ab%e3%81%aa%e3%82%8a%e3%81%be%e3%81%99%e3%80%82%0a%e4%bb%a5%e5%89%8d%e3%81%af%e3%80%81ViewModelProvider.of%28activity%29%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%e5%8f%96%e5%be%97%e3%81%97%e3%81%a6%e3%81%84%e3%81%be%e3%81%97%e3%81%9f%e3%81%8c%e3%80%81lifecycle%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b32.2.0-alpha03%e3%81%8b%e3%82%89Deprecated%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%84%e3%81%be%e3%81%97%e3%81%9f%e3%80%82%20https%3a%2f%2fdeveloper.android.com%2fjetpack%2fandroidx%2freleases%2flifecycle%232.2.0-alpha03%0a%e3%81%be%e3%81%9f%e3%80%81kotlin%20propertey%20Delegation%e3%82%92%e4%bd%bf%e3%81%86%e3%81%ab%e3%81%affragment-ktx%e3%81%ae1.1.0%e4%bb%a5%e4%b8%8a%e3%82%92%e4%bd%bf%e3%81%86%e5%bf%85%e8%a6%81%e3%81%8c%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%80%82%0aimplementation%20%26quot%3bandroidx.fragment%3afragment-ktx%3a1.1.0%26quot%3b%20%20https%3a%2f%2fdeveloper.android.com%2fjetpack%2fandroidx%2freleases%2ffragment%231.1.0%0aViewModel%e3%81%ae%e7%94%9f%e5%ad%98%e6%9c%9f%e9%96%93%20ViewModel%e3%81%ae%e7%94%9f%e5%ad%98%e6%9c%9f%e9%96%93%e3%81%afActivity%e3%82%84Fragment%e3%82%88%e3%82%8a%e3%82%82%e9%95%b7%e3%81%84%e3%81%a7%e3%81%99%e3%80%82%20%e4%b8%8b%e5%9b%b3%e3%81%afActivity%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%97%e3%81%a6%e3%80%81%e7%94%bb%e9%9d%a2%e3%82%92%e5%9b%9e%e8%bb%a2%e3%81%95%e3%81%9b%e3%80%81%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%82%bf%e3%83%b3%e3%81%a7%e3%82%a2%e3%83%97%e3%83%aa%e3%82%92%e7%b5%82%e4%ba%86%e3%81%97%e3%81%9f%e3%81%a8%e3%81%8d%e3%81%ae%e7%8a%b6%e6%85%8b%e9%81%b7%e7%a7%bb%e3%81%a7%e3%81%99%e3%80%82%0a%e8%b5%b7%e5%8b%95%20onCreate%20viewModel%20created%28%e6%ad%a3%e7%a2%ba%e3%81%ab%e3%81%afLazy%e3%81%aa%e3%81%ae%e3%81%a7%e3%82%a2%e3%82%af%e3%82%bb%e3%82%b9%e3%81%97%e3%81%9f%e3%82%bf%e3%82%a4%e3%83%9f%e3%83%b3%e3%82%b0%29%20onStart%20onResume%20%e5%9b%9e%e8%bb%a2%20onPause%20onStop%20onDestroy%20onCreate%20onStart%20onResume%20%e3%83%90%e3%83%83%e3%82%af%e3%83%9c%e3%82%bf%e3%83%b3%e3%81%a7%e3%82%a2%e3%83%97%e3%83%aa%e7%b5%82%e4%ba%86%20onPause%20onStop%20viewModel%20onCleared%20onDestroy%20%20%e7%94%bb%e9%9d%a2%e5%9b%9e%e8%bb%a2%e6%99%82%e3%81%ab%e3%80%81Activity%e3%81%afonDestroy%e3%81%95%e3%82%8c%e3%81%a6%e3%81%84%e3%81%be%e3%81%99%e3%81%8c%e3%80%81ViewModel%e3%81%afonCleared%e3%81%8c%e5%91%bc%e3%81%b0%e3%82%8c%e3%81%a6%e3%81%84%e3%81%be%e3%81%9b%e3%82%93%e3%80%82..." class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803 c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048 h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501 c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546 C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
                  </svg>
              </span>
              <span class="text">LinkedIn</span>
          </a>
      </li>
      <li class="tumblr">
					<script>
						document.write('<a href="http://www.tumblr.com/share?v=3&amp;u=' + encodeURIComponent('https:\/\/kwmt27.net\/2019\/09\/19\/android-lifecycle-codelab\/') + '&amp;t=Android Lifecycle関連コンポーネントについて" class="popup">');
					</script>
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<path d="M18.02 21.842c-2.029 0.052-2.422-1.396-2.439-2.446v-7.294h4.729V7.874h-4.71V1.592c0 0-3.653 0-3.714 0 s-0.167 0.053-0.182 0.186c-0.218 1.935-1.144 5.33-4.988 6.688v3.637h2.927v7.677c0 2.8 1.7 6.7 7.3 6.6 c1.863-0.03 3.934-0.795 4.392-1.453l-1.22-3.539C19.595 21.6 18.7 21.8 18 21.842z"/>
									</svg>
              </span>
              <span class="text">Tumblr</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="reddit">
          <a href="http://www.reddit.com/submit?url=https://kwmt27.net/2019/09/19/android-lifecycle-codelab/">
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<g>
													<path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"/>
													<path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"/>
													<path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 19.5 17.8 19.5 17.5 19.791z"/>
													<path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 C26.354 13.8 26.1 14.3 25.8 14.605z"/>
											</g>
									</svg>
              </span>
              <span class="text">Reddit</span>
          </a>
      </li>
      <li class="googleplus">
          <a href="https://plus.google.com/share?url=https://kwmt27.net/2019/09/19/android-lifecycle-codelab/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <g>
                          <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663 c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027 C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068 c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562 c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41 c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511 c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478 c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492 c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479 c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                          <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004 23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89"/>
                      </g>
                  </svg>
              </span>
              <span class="text">Google+</span>
          </a>
      </li>
      <li class="pinterest">
          <script>
						var imgurl = "https:\/\/kwmt27.net\/logo.png";
						var firstimg = document.getElementsByClassName("post")[0].getElementsByTagName("img")[0];
						if (firstimg !== undefined) {
							imgurl = firstimg.src;
						}
						document.write('<a href="http://pinterest.com/pin/create/button/?url=https:\/\/kwmt27.net\/2019\/09\/19\/android-lifecycle-codelab\/&amp;media=' + imgurl + '&amp;description=Android Lifecycle関連コンポーネントについて" class="popup">');
					</script>
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785 C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458 c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557 c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168 C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239 c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"/>
                  </svg>
              </span>
              <span class="text">Pinterest</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="pocket">
          <a href="https://getpocket.com/save?url=https://kwmt27.net/2019/09/19/android-lifecycle-codelab/"  class="popup">
              <span class="icon">
                  <svg width="32px" height="28px" viewBox="0 0 32 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                      <path d="M28.7817528,0.00172488695 C30.8117487,0.00431221738 31.9749312,1.12074529 31.9644402,3.10781507 C31.942147,6.67703739 32.1336065,10.2669583 31.8057648,13.8090137 C30.7147076,25.5813672 17.2181194,31.8996281 7.20714461,25.3808491 C2.71833574,22.4571656 0.196577202,18.3122624 0.0549495772,12.9357897 C-0.0342233715,9.5774348 0.00642900214,6.21519891 0.0300336062,2.85555035 C0.0405245414,1.1129833 1.21157517,0.0146615391 3.01995012,0.00819321302 C7.34746087,-0.00603710433 11.6775944,0.00431221738 16.0064164,0.00172488695 C20.2644248,0.00172488695 24.5237444,-0.00215610869 28.7817528,0.00172488695 L28.7817528,0.00172488695 Z M8.64885184,7.85611511 C7.38773662,7.99113854 6.66148108,8.42606978 6.29310958,9.33228474 C5.90114134,10.2969233 6.17774769,11.1421181 6.89875951,11.8276216 C9.35282156,14.161969 11.8108164,16.4924215 14.2976518,18.7943114 C15.3844131,19.7966007 16.5354102,19.7836177 17.6116843,18.7813283 C20.0185529,16.5495467 22.4070683,14.2982907 24.7824746,12.0327533 C25.9845979,10.8850542 26.1012707,9.56468083 25.1469132,8.60653379 C24.1361858,7.59255976 22.8449191,7.6743528 21.5890476,8.85191291 C19.9936451,10.3488554 18.3680912,11.8172352 16.8395462,13.3777945 C16.1342655,14.093159 15.7200114,14.0048744 15.0566806,13.3440386 C13.4599671,11.7484252 11.8081945,10.2060421 10.1262706,8.70001155 C9.65564653,8.27936164 9.00411403,8.05345704 8.64885184,7.85611511 L8.64885184,7.85611511 L8.64885184,7.85611511 Z"></path>
                  </svg>
              </span>
              <span class="text">Pocket</span>
          </a>
      </li>
  </ul>
</div>

    <div id="recent">
  <section>
    <h5>Recent Posts:</h5>
    <ul>
      
      <li>
        <a href="https://kwmt27.net/2021/12/31/looking-back-2021/">2021年振り返り - 1 Minutes</a>
      </li>
      
      <li>
        <a href="https://kwmt27.net/2021/07/30/android-camera2-light-on-by-light-sensor/">Camera2APIでカメラプレビュー中に光センサーの値によってライトを自動でON/OFFにする - 1 Minutes</a>
      </li>
      
      <li>
        <a href="https://kwmt27.net/2021/06/12/jetpack-compose-camerax/">Jetpack ComposeでCameraXを実装する - 1 Minutes</a>
      </li>
      
      <li>
        <a href="https://kwmt27.net/2021/06/12/android-update-targertsdk-from-28-to-30/">Android targetSdkVersionを28から30への変更したときのメモ - 1 Minutes</a>
      </li>
      
      <li>
        <a href="https://kwmt27.net/2021/05/15/jetpack-compose-searchbar/">Jetpack Composeでインクリメンタルサーチ(SearchBar UI)を実装するには - 1 Minutes</a>
      </li>
      
    </ul>
  </section>
</div>

    
    <div id="comments">
    
    
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'kwmt27';
      var disqus_identifier = 'https:\/\/kwmt27.net\/2019\/09\/19\/android-lifecycle-codelab\/';
      var disqus_title = 'Android Lifecycle関連コンポーネントについて';
      var disqus_url = 'https:\/\/kwmt27.net\/2019\/09\/19\/android-lifecycle-codelab\/';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    
</div>

</article>  

</main>
		<footer id="footer">
			<section id="footer-message">&copy; Androg. All rights reserved. Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>. <a href="https://github.com/kathyqian/crisp-ghost-theme" target="_blank">Crisp</a> theme by <a href="http://kathyqian.com" target="_blank">Kathy Qian</a>.</section>
		</footer>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      var WebFontConfig={google:{families:["Open Sans:300italic,700italic,300,700","Bree+Serif"]}};
      asyncLoader([
        "//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css",
        "//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js",
        "//cdnjs.cloudflare.com/ajax/libs/webfont/1.5.16/webfontloader.js",
        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js",
        "//cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.1/es5/tex-mml-chtml.js"
      ],{
        callback:function(){
          asyncLoader([
            "https:\/\/kwmt27.net\/css/rrssb.css",
            "https:\/\/kwmt27.net\/js/gist.min.js", 
            "https:\/\/kwmt27.net\/js/rrssb.min.js",
            "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css"
          ], { callback:function() {
              hljs.initHighlighting();
          }});
        }
      });
    </script>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$','$'], ['\\(','\\)']]
        }
      };
    </script>    
	
    <script>
    	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      	ga('create', 'UA-39334884-1', 'auto');
      	ga('send', 'pageview');
    </script>
  
	</body>
</html>